<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTOADA Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: #111827;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-900 text-white">
    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md bg-gray-800 rounded-2xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-yellow-400 mb-2">OTOADA</h1>
                <p class="text-gray-400">Admin Dashboard</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">E-posta</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="w-full px-4 py-4 bg-gray-700 border border-gray-600 rounded-lg text-white text-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                        placeholder="E-postanƒ±zƒ± girin"
                        autocomplete="email"
                        required
                    >
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">≈ûifre</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="w-full px-4 py-4 bg-gray-700 border border-gray-600 rounded-lg text-white text-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                        placeholder="≈ûifrenizi girin"
                        autocomplete="current-password"
                        required
                    >
                </div>
                
                <button 
                    type="submit" 
                    class="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-all duration-200 shadow-lg"
                >
                    Giri≈ü
                </button>
            </form>
            
            <div id="login-error" class="mt-4 text-red-400 text-sm text-center hidden"></div>
        </div>
    </div>

    <!-- Dashboard (Hidden by default) -->
    <div id="dashboard" class="hidden min-h-screen flex">
        <!-- Sidebar -->
        <div class="w-64 bg-gray-800 border-r border-gray-700 flex-shrink-0">
            <!-- Sidebar Header -->
            <div class="p-6 border-b border-gray-700">
                <h1 class="text-2xl font-bold text-yellow-400">OTOADA ADMIN</h1>
                <button 
                    onclick="logout()" 
                    class="mt-4 w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors duration-200"
                >
                    √áƒ±kƒ±≈ü
                </button>
            </div>
            
            <!-- Sidebar Menu -->
            <nav class="p-4 space-y-2">
                <button 
                    onclick="filterCars('pending')" 
                    id="filter-pending"
                    class="w-full text-left px-4 py-3 rounded-lg bg-yellow-500 bg-opacity-20 text-yellow-400 font-medium transition-colors duration-200 hover:bg-opacity-30"
                >
                    ‚è≥ Onay Bekleyenler
                </button>
                <button 
                    onclick="filterCars('published')" 
                    id="filter-published"
                    class="w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-gray-300 font-medium transition-colors duration-200 hover:bg-gray-600"
                >
                    ‚úÖ Yayƒ±ndakiler
                </button>
                <button 
                    onclick="filterCars('sold')" 
                    id="filter-sold"
                    class="w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-gray-300 font-medium transition-colors duration-200 hover:bg-gray-600"
                >
                    üí∞ Satƒ±ldƒ±
                </button>
                <button 
                    onclick="filterCars('rejected')" 
                    id="filter-rejected"
                    class="w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-gray-300 font-medium transition-colors duration-200 hover:bg-gray-600"
                >
                    ‚ùå Reddedilenler
                </button>
                <button 
                    onclick="filterCars('all')" 
                    id="filter-all"
                    class="w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-gray-300 font-medium transition-colors duration-200 hover:bg-gray-600"
                >
                    üìÇ T√ºm ƒ∞lanlar
                </button>
                <button 
                    onclick="showUsersTab()" 
                    id="users-tab"
                    class="w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-gray-300 font-medium transition-colors duration-200 hover:bg-gray-600 mt-4"
                >
                    üë• Kullanƒ±cƒ±lar
                </button>
                <button 
                    onclick="showAmbassadorsTab()" 
                    id="ambassadors-tab"
                    class="w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-gray-300 font-medium transition-colors duration-200 hover:bg-gray-600"
                >
                    üåü El√ßiler
                </button>
                <button 
                    onclick="showGalleriesTab()" 
                    id="galleries-tab"
                    class="w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-gray-300 font-medium transition-colors duration-200 hover:bg-gray-600"
                >
                    üè¢ Galeriler
                </button>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <div class="bg-gray-800 border-b border-gray-700 p-4">
                <h2 id="current-filter-title" class="text-2xl font-bold text-white">‚è≥ Onay Bekleyenler</h2>
                <p id="record-count" class="text-gray-400 text-sm mt-1">0 ilan</p>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Loading State -->
                <div id="loading" class="text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-400"></div>
                    <p class="mt-4 text-gray-400">Y√ºkleniyor...</p>
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="hidden text-center py-12">
                    <p class="text-2xl text-gray-400 mb-2">ƒ∞lan bulunamadƒ±</p>
                    <p class="text-gray-500">Bu kategoride hi√ß ilan yok.</p>
                </div>

                <!-- Error State -->
                <div id="error-state" class="hidden text-center py-12">
                    <p class="text-2xl text-red-400 mb-2">Bir hata olu≈ütu</p>
                    <p class="text-gray-500 mb-4" id="error-message"></p>
                    <button 
                        onclick="fetchAllCars()" 
                        class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg"
                    >
                        Tekrar Dene
                    </button>
                </div>

                <!-- Cars Grid -->
                <div id="cars-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden">
                    <!-- Cars will be dynamically inserted here -->
                </div>

                <!-- Users Section -->
                <div id="users-section" class="content-section" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-white">Kullanƒ±cƒ±lar</h2>
                        <span id="total-users-count" class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm">0 Kullanƒ±cƒ±</span>
                    </div>
                    
                    <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg border border-gray-700">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-gray-300">
                                <thead class="bg-gray-900 text-gray-100 uppercase text-sm font-semibold">
                                    <tr>
                                        <th class="px-6 py-4">Ad Soyad</th>
                                        <th class="px-6 py-4">E-Posta</th>
                                        <th class="px-6 py-4">WhatsApp</th>
                                        <th class="px-6 py-4">Rol</th>
                                        <th class="px-6 py-4 text-right">ƒ∞≈ülemler</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body" class="divide-y divide-gray-700">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-90 p-4">
        <div class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-gray-800 border-b border-gray-700 px-6 py-4 flex items-center justify-between z-10">
                <h2 class="text-2xl font-bold text-yellow-400">ƒ∞lanƒ± D√ºzenle</h2>
                <button 
                    onclick="closeEditModal()" 
                    class="text-gray-400 hover:text-white transition-colors"
                >
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6 space-y-6">
                <form id="edit-form">
                    <!-- Marka -->
                    <div>
                        <label for="edit-marka" class="block text-sm font-medium text-gray-300 mb-2">Marka *</label>
                        <input 
                            type="text" 
                            id="edit-marka" 
                            required
                            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                            placeholder="√ñrn: Mercedes"
                        >
                    </div>

                    <!-- Model -->
                    <div>
                        <label for="edit-model" class="block text-sm font-medium text-gray-300 mb-2">Model *</label>
                        <input 
                            type="text" 
                            id="edit-model" 
                            required
                            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                            placeholder="√ñrn: E250d"
                        >
                    </div>

                    <!-- Fiyat & ParaBirimi -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="edit-fiyat" class="block text-sm font-medium text-gray-300 mb-2">Fiyat *</label>
                            <input 
                                type="number" 
                                id="edit-fiyat" 
                                required
                                min="0"
                                step="1"
                                class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                placeholder="√ñrn: 15000"
                            >
                        </div>
                        <div>
                            <label for="edit-parabirimi" class="block text-sm font-medium text-gray-300 mb-2">Para Birimi *</label>
                            <select 
                                id="edit-parabirimi" 
                                required
                                class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                            >
                                <option value="STG">STG (¬£)</option>
                                <option value="TL">TL (‚Ç∫)</option>
                                <option value="EUR">EUR (‚Ç¨)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Satƒ±cƒ± -->
                    <div>
                        <label for="edit-satici" class="block text-sm font-medium text-gray-300 mb-2">Satƒ±cƒ± *</label>
                        <input 
                            type="text" 
                            id="edit-satici" 
                            required
                            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                            placeholder="Satƒ±cƒ± adƒ±"
                        >
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="sticky bottom-0 bg-gray-800 border-t border-gray-700 px-6 py-4 flex flex-col sm:flex-row gap-3">
                <button 
                    onclick="saveCarEdit(false)" 
                    id="edit-save-btn"
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-colors duration-200"
                >
                    Kaydet
                </button>
                <button 
                    onclick="saveCarEdit(true)" 
                    id="edit-save-publish-btn"
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-colors duration-200"
                >
                    Kaydet ve Yayƒ±nla
                </button>
                <button 
                    onclick="closeEditModal()" 
                    class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-colors duration-200"
                >
                    Kapat
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Load secrets.js FIRST before any other scripts that use secrets -->
    <script src="secrets.js"></script>
    <script src="config.js"></script>
    <script src="admin.js"></script>
</body>
</html>
